
<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge' http-equiv='X-UA-Compatible'>
<meta content='GitLab Community Edition' name='description'>
<title>DBUtils | master | znsd / courses | GitLab</title>
<link href="/assets/favicon-5738a6efe01f3282080df5f467da72a9.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
<link href="/assets/application-ffeeed35892b38ff9bfa135564fb0830.css" media="all" rel="stylesheet" />
<link href="/assets/print-47fe51cdf70398e5e54b544e0f5cc718.css" media="print" rel="stylesheet" />
<script src="/assets/application-3302fd299e1a3e701974f594a4a76c56.js"></script>
<meta content="authenticity_token" name="csrf-param" />
<meta content="ZVNlzkG2D0kslABmtdXbLtUBUPctwNAwcvkLgdeUxcc=" name="csrf-token" />
<script type="text/javascript">
//<![CDATA[
window.gon={};gon.default_issues_tracker="gitlab";gon.api_version="v3";gon.relative_url_root="";gon.default_avatar_url="http://192.168.1.15/assets/no_avatar-0b64d25ac5f63e6f0caee99e819105ba.png";gon.max_file_size=500;gon.current_user_id=24;gon.api_token="Vkyp5--haXaUrFB4iTsZ";
//]]>
</script>
<meta content='width=device-width, initial-scale=1, maximum-scale=1' name='viewport'>
<meta content='#474D57' name='theme-color'>
<link href="/assets/touch-icon-iphone-4c0496ac9f88e7961644c66b289a6614.png" rel="apple-touch-icon" type="image/vnd.microsoft.icon" />
<link href="/assets/touch-icon-ipad-d64abe7a8e8be6e02245d2ed79da6ff9.png" rel="apple-touch-icon" sizes="76x76" type="image/vnd.microsoft.icon" />
<link href="/assets/touch-icon-iphone-retina-54af16810ab006406b4df81f8a92fe8d.png" rel="apple-touch-icon" sizes="120x120" type="image/vnd.microsoft.icon" />
<link href="/assets/touch-icon-ipad-retina-72774a950890a9e3811ab91f186cc11f.png" rel="apple-touch-icon" sizes="152x152" type="image/vnd.microsoft.icon" />
<meta content='http://192.168.1.15/assets/msapplication-tile-fc54d4a5d37bcda7967a2b70dedf3327.png' name='msapplication-TileImage'>
<meta content='#30353E' name='msapplication-TileColor'>
<link href="http://192.168.1.15/znsd/courses/commits/master.atom?private_token=Vkyp5--haXaUrFB4iTsZ" rel="alternate" title="courses:master commits" type="application/atom+xml" />




</head>

<body class='ui_charcoal' data-page='projects:tree:show'>
<script>
  window.project_uploads_path = "/znsd/courses/uploads";
  window.markdown_preview_path = "/znsd/courses/markdown_preview";
</script>

<header class='header-expanded navbar navbar-fixed-top navbar-gitlab'>
<div class='container'>
<div class='header-logo'>
<a class="home" data-placement="bottom" data-toggle="tooltip" href="/" id="js-shortcuts-home" title="Dashboard"><img alt="Logo" src="/assets/logo-ca207549507c811d027110077cf86e90.svg" />
<div class='gitlab-text-container'>
<h3>GitLab</h3>
</div>
</a></div>
<div class='header-content'>
<button class='navbar-toggle' type='button'>
<span class='sr-only'>Toggle navigation</span>
<i class="fa fa-bars"></i>
</button>
<div class='navbar-collapse collapse'>
<ul class='nav navbar-nav pull-right'>
<li class='hidden-sm hidden-xs'>
<div class='search'>
<form accept-charset="UTF-8" action="/search" class="navbar-form pull-left" method="get"><div style="display:none"><input name="utf8" type="hidden" value="&#x2713;" /></div>
<input class="search-input form-control" id="search" name="search" placeholder="Search in this project" type="search" />
<input id="group_id" name="group_id" type="hidden" />
<input id="project_id" name="project_id" type="hidden" value="7" />
<input id="search_code" name="search_code" type="hidden" value="true" />
<input id="repository_ref" name="repository_ref" type="hidden" value="master" />

<div class='search-autocomplete-opts hide' data-autocomplete-path='/search/autocomplete' data-autocomplete-project-id='7' data-autocomplete-project-ref='master'></div>
</form>

</div>
<script>
  $('.search-input').on('keyup', function(e) {
    if (e.keyCode == 27) {
      $('.search-input').blur()
    }
  })
</script>

</li>
<li class='visible-sm visible-xs'>
<a data-placement="bottom" data-toggle="tooltip" href="/search" title="Search"><i class="fa fa-search"></i>
</a></li>
<li class='hidden-xs'>
<a data-placement="bottom" data-toggle="tooltip" href="/help" title="Help"><i class="fa fa-question-circle fa-fw"></i>
</a></li>
<li>
<a data-placement="bottom" data-toggle="tooltip" href="/explore" title="Explore"><i class="fa fa-globe fa-fw"></i>
</a></li>
<li>
<a data-placement="bottom" data-toggle="tooltip" href="/s/huangjunkai" title="Your snippets"><i class="fa fa-clipboard fa-fw"></i>
</a></li>
<li class='hidden-xs'>
<a data-placement="bottom" data-toggle="tooltip" href="/projects/new" title="New project"><i class="fa fa-plus fa-fw"></i>
</a></li>
<li>
<a data-placement="bottom" data-toggle="tooltip" href="/profile" title="Profile settings"><i class="fa fa-cog fa-fw"></i>
</a></li>
<li>
<a class="logout" data-method="delete" data-placement="bottom" data-toggle="tooltip" href="/users/sign_out" rel="nofollow" title="Sign out"><i class="fa fa-sign-out"></i>
</a></li>
</ul>
</div>
<h1 class='title'><span><a href="/groups/znsd">znsd</a> / <a href="/znsd/courses">courses</a></span></h1>
</div>
</div>
</header>


<div class='page-sidebar-expanded page-with-sidebar'>

<div class='sidebar-wrapper nicescroll'>
<ul class='nav nav-sidebar'>
<li class=""><a class="back-link" data-placement="right" href="/groups/znsd" title="Back to group"><i class="fa fa-caret-square-o-left fa-fw"></i>
<span>
Back to Group
</span>
</a></li><li class='separate-item'></li>
<li class="home"><a class="shortcuts-project" data-placement="right" href="/znsd/courses" title="Project"><i class="fa fa-home fa-fw"></i>
<span>
Project
</span>
</a></li><li class=""><a class="shortcuts-project-activity" data-placement="right" href="/znsd/courses/activity" title="Project Activity"><i class="fa fa-dashboard fa-fw"></i>
<span>
Activity
</span>
</a></li><li class="active"><a class="shortcuts-tree" data-placement="right" href="/znsd/courses/tree/master" title="Files"><i class="fa fa-files-o fa-fw"></i>
<span>
Files
</span>
</a></li><li class=""><a class="shortcuts-commits" data-placement="right" href="/znsd/courses/commits/master" title="Commits"><i class="fa fa-history fa-fw"></i>
<span>
Commits
</span>
</a></li><li class=""><a class="shortcuts-network" data-placement="right" href="/znsd/courses/network/master" title="Network"><i class="fa fa-code-fork fa-fw"></i>
<span>
Network
</span>
</a></li><li class=""><a class="shortcuts-graphs" data-placement="right" href="/znsd/courses/graphs/master" title="Graphs"><i class="fa fa-area-chart fa-fw"></i>
<span>
Graphs
</span>
</a></li><li class=""><a data-placement="right" href="/znsd/courses/milestones" title="Milestones"><i class="fa fa-clock-o fa-fw"></i>
<span>
Milestones
</span>
</a></li><li class=""><a class="shortcuts-issues" data-placement="right" href="/znsd/courses/issues" title="Issues"><i class="fa fa-exclamation-circle fa-fw"></i>
<span>
Issues
<span class='count issue_counter'>0</span>
</span>
</a></li><li class=""><a class="shortcuts-merge_requests" data-placement="right" href="/znsd/courses/merge_requests" title="Merge Requests"><i class="fa fa-tasks fa-fw"></i>
<span>
Merge Requests
<span class='count merge_counter'>0</span>
</span>
</a></li><li class=""><a data-placement="right" href="/znsd/courses/labels" title="Labels"><i class="fa fa-tags fa-fw"></i>
<span>
Labels
</span>
</a></li><li class=""><a class="shortcuts-wiki" data-placement="right" href="/znsd/courses/wikis/home" title="Wiki"><i class="fa fa-book fa-fw"></i>
<span>
Wiki
</span>
</a></li></ul>

<div class='collapse-nav'>
<a class="toggle-nav-collapse" href="#" title="Open/Close"><i class="fa fa-angle-left"></i></a>

</div>
<a class="sidebar-user" href="/u/huangjunkai"><img alt="User activity" class="avatar avatar s32" src="http://www.gravatar.com/avatar/420568c35150a2382a855661c132e598?s=60&amp;d=identicon" />
<div class='username'>
huangjunkai
</div>
</a></div>
<div class='content-wrapper'>
<div class='container-fluid'>
<div class='content'>
<div class='flash-container'>
</div>

<div class='clearfix'>

<div class='tree-ref-holder'>
<form accept-charset="UTF-8" action="/znsd/courses/refs/switch" class="project-refs-form" method="get"><div style="display:none"><input name="utf8" type="hidden" value="&#x2713;" /></div>
<select class="project-refs-select select2 select2-sm" id="ref" name="ref"><optgroup label="Branches"><option selected="selected" value="master">master</option></optgroup><optgroup label="Tags"></optgroup></select>
<input id="destination" name="destination" type="hidden" value="tree" />
<input id="path" name="path" type="hidden" value="DBUtils" />
</form>


</div>
<div class='tree-download-holder'>
<span class='btn-group hidden-sm hidden-xs pull-right'>
<a class="btn col-xs-10" href="/znsd/courses/repository/archive.zip?ref=master" rel="nofollow"><i class='fa fa-download'></i>
<span>Download zip</span>
</a><a class='col-xs-2 btn dropdown-toggle' data-toggle='dropdown'>
<span class='caret'></span>
<span class='sr-only'>
Select Archive Format
</span>
</a>
<ul class='col-xs-10 dropdown-menu' role='menu'>
<li>
<a href="/znsd/courses/repository/archive.zip?ref=master" rel="nofollow"><i class='fa fa-download'></i>
<span>Download zip</span>
</a></li>
<li>
<a href="/znsd/courses/repository/archive.tar.gz?ref=master" rel="nofollow"><i class='fa fa-download'></i>
<span>Download tar.gz</span>
</a></li>
<li>
<a href="/znsd/courses/repository/archive.tar.bz2?ref=master" rel="nofollow"><i class='fa fa-download'></i>
<span>Download tar.bz2</span>
</a></li>
<li>
<a href="/znsd/courses/repository/archive.tar?ref=master" rel="nofollow"><i class='fa fa-download'></i>
<span>Download tar</span>
</a></li>
</ul>
</span>

</div>
<div class='tree-holder clearfix' id='tree-holder'>
<ul class='breadcrumb repo-breadcrumb'>
<li>
<a href="/znsd/courses/tree/master">courses
</a></li>
<li>
<a href="/znsd/courses/tree/master/DBUtils">DBUtils</a>
</li>
</ul>
<div class='tree-content-holder' id='tree-content-holder'>
<table class='table_4ae20f2891836e4749bb5c9a86c20b4e9af57adb tree-table' id='tree-slider'>
<thead>
<tr>
<th>Name</th>
<th>Last Update</th>
<th class='hidden-xs'>
<div class='pull-left'>Last Commit</div>
<div class='last-commit hidden-sm pull-left'>
&nbsp;
<i class='fa fa-angle-right'></i>
&nbsp;
<small class='light'>
<a href="/znsd/courses/commit/4591f19cbd1f58ec9b8cb59071d0e1db74cefd4f">4591f19c</a>
&ndash;
servlet 3 final
</small>
</div>
<a class="pull-right" href="/znsd/courses/commits/master/DBUtils">History</a>
</th>
</tr>
</thead>
<tr class='tree-item'>
<td class='tree-item-file-name'>
<a class="prepend-left-10" href="/znsd/courses/tree/master/DBUtils/..">..</a>
</td>
<td></td>
<td class='hidden-xs'></td>
</tr>
<tr class='tree-item file_8ec9a00bfd09b3190ac6b22251dbb1aa95a0579d'>
<td class='tree-item-file-name'>
<i class="fa fa-file-text-o fa-fw"></i>
<span class='str-truncated'>
<a href="/znsd/courses/blob/master/DBUtils/README.md">README.md</a>
</span>
</td>
<td class='tree_time_ago cgray'>
<span class='log_loading hide'>
<i class='fa fa-spinner fa-spin'></i>
Loading commit data...
</span>

</td>
<td class='hidden-xs tree_commit'></td>
</tr>
<tr class='tree-item file_e1d60c5855c7c17dc214c0a1915910c5ddbc5679'>
<td class='tree-item-file-name'>
<i class="fa fa-file-archive-o fa-fw"></i>
<span class='str-truncated'>
<a href="/znsd/courses/blob/master/DBUtils/c3p0-0.9.5.2.bin.zip">c3p0-0.9.5.2.bin.zip</a>
</span>
</td>
<td class='tree_time_ago cgray'>
<span class='log_loading hide'>
<i class='fa fa-spinner fa-spin'></i>
Loading commit data...
</span>

</td>
<td class='hidden-xs tree_commit'></td>
</tr>
<tr class='tree-item file_2dd5640aa9d4db1e653c5869ecdd4b4329ec838c'>
<td class='tree-item-file-name'>
<i class="fa fa-file-archive-o fa-fw"></i>
<span class='str-truncated'>
<a href="/znsd/courses/blob/master/DBUtils/commons-dbutils-1.7-bin.zip">commons-dbutils-1.7-bin.zip</a>
</span>
</td>
<td class='tree_time_ago cgray'>
<span class='log_loading hide'>
<i class='fa fa-spinner fa-spin'></i>
Loading commit data...
</span>

</td>
<td class='hidden-xs tree_commit'></td>
</tr>
<tr class='tree-item file_f71bd38dc4676ee653cb9cedc2b0fec8f0300265'>
<td class='tree-item-file-name'>
<i class="fa fa-file-archive-o fa-fw"></i>
<span class='str-truncated'>
<a href="/znsd/courses/blob/master/DBUtils/mysql-connector-java-5.1.22.zip">mysql-connector-java-5.1.22.zip</a>
</span>
</td>
<td class='tree_time_ago cgray'>
<span class='log_loading hide'>
<i class='fa fa-spinner fa-spin'></i>
Loading commit data...
</span>

</td>
<td class='hidden-xs tree_commit'></td>
</tr>

</table>
<article class='readme-holder' id='README'>
<a href="#README"><h4 class='readme-file-title'>
<i class='fa fa-file'></i>
README.md
</h4>
</a><div class='wiki'>
<h2>&#x000A;<a id="dbutils-学习使用" class="anchor" href="#dbutils-%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8" aria-hidden="true"></a>DBUtils 学习使用</h2>&#x000A;&#x000A;<h3>&#x000A;<a id="commons-dbutils简介" class="anchor" href="#commons-dbutils%E7%AE%80%E4%BB%8B" aria-hidden="true"></a>commons-dbutils简介</h3>&#x000A;&#x000A;<p>commons-dbutils是Apache组织提供的一个开源JDBC工具类库，它是对JDBC的简单封装，学习成本极低，并且使用dbutils能极大简化jdbc编码的工作量，同时也不会影响程序的性能。因此dbutils成为很多不喜欢hibernate的公司的首选。 dbutils的官方网站<a href="http://commons.apache.org/proper/commons-dbutils/download_dbutils.cgi" rel="nofollow">http://commons.apache.org/proper/commons-dbutils/download_dbutils.cgi</a></p>&#x000A;&#x000A;<p><img src="http://192.168.1.15/znsd/courses/uploads/9b70be94119be474bef116e61354d4a4/image.png" alt="image"></p>&#x000A;&#x000A;<h3>&#x000A;<a id="dbutils-优点" class="anchor" href="#dbutils-%E4%BC%98%E7%82%B9" aria-hidden="true"></a>dbutils 优点</h3>&#x000A;&#x000A;<ol>&#x000A;<li>对于数据表的读操作，他可以把结果转换成List，Array，Set等java集合，便于程序员操作；</li>&#x000A;<li>对于数据表的写操作，也变得很简单（只需写sql语句）</li>&#x000A;<li>可以使用数据源，使用JNDI，数据库连接池(dbcp,c3p0)等技术来优化性能--重用已经构建好的数据库连接对象，而不像php，asp那样，费时费力的不断重复的构建和析构这样的对象。</li>&#x000A;</ol>&#x000A;&#x000A;<h3>&#x000A;<a id="commons-dbutils-api介绍" class="anchor" href="#commons-dbutils-api%E4%BB%8B%E7%BB%8D" aria-hidden="true"></a>commons-dbutils API介绍</h3>&#x000A;&#x000A;<ul>&#x000A;<li>org.apache.commons.dbutils.QueryRunner QueryRunner （insert、update、delete使用）</li>&#x000A;<li>org.apache.commons.dbutils.ResultSetHandler （用于查询结果处理使用）</li>&#x000A;<li>org.apache.commons.dbutils.DbUtils （工具类）</li>&#x000A;</ul>&#x000A;&#x000A;<h4>&#x000A;<a id="queryrunner-类的主要方法" class="anchor" href="#queryrunner-%E7%B1%BB%E7%9A%84%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95" aria-hidden="true"></a>QueryRunner 类的主要方法</h4>&#x000A;&#x000A;<ul>&#x000A;<li>&#x000A;<code>public Object query(Connection conn, String sql, Object[] params, ResultSetHandler rsh) throws SQLException</code> </li>&#x000A;</ul>&#x000A;&#x000A;<p>执行一个查询操作，在这个查询中，对象数组中的每个元素值被用来作为查询语句的置换参数。该方法会自行处理PreparedStatement和ResultSet的创建和关闭。</p>&#x000A;&#x000A;<ul>&#x000A;<li>&#x000A;<code>public Object query(String sql, Object[] params, ResultSetHandler rsh) throws SQLException</code> </li>&#x000A;</ul>&#x000A;&#x000A;<p>几乎与第一种方法一样；唯一的不同在于它不将数据库连接提供给方法，并且它是从提供给构造方法的数据源(DataSource)或使用的setDataSource方法中重新获得Connection。</p>&#x000A;&#x000A;<ul>&#x000A;<li>&#x000A;<code>public Object query(Connection conn, String sql, ResultSetHandler rsh) throws SQLException</code> </li>&#x000A;</ul>&#x000A;&#x000A;<p>执行一个不需要置换参数的查询操作。</p>&#x000A;&#x000A;<ul>&#x000A;<li>&#x000A;<code>public int update(Connection conn, String sql, Object[] params) throws SQLException</code> </li>&#x000A;</ul>&#x000A;&#x000A;<p>用来执行一个更新（插入、更新或删除）操作。</p>&#x000A;&#x000A;<ul>&#x000A;<li>&#x000A;<code>public int update(Connection conn, String sql) throws SQLException</code> </li>&#x000A;</ul>&#x000A;&#x000A;<p>用来执行一个不需要置换参数的更新操作。</p>&#x000A;&#x000A;<ul>&#x000A;<li>&#x000A;<code>public int[] batch(Connection conn, String sql, Object[][] params) throws SQLException</code> </li>&#x000A;</ul>&#x000A;&#x000A;<p>这个方法对应着批处理，经常用于在同一个表中批量插入数据，或批量更新表的数据。 &#x000A;  该方法为何会接收二维数组<code>Object[][] params</code>呢？ &#x000A;  答：例如现在要想在同一个表中批量插入数据，编写的SQL语句为：</p>&#x000A;<pre class="code highlight white java"><code>  <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"insert into users(id,name) values(?,?)"</span><span class="o">;</span>&#x000A;</code></pre>&#x000A;&#x000A;<p>该方法接收二维数组<code>Object[][] params</code>，那么调用其的时候就要传递一个诸如这样的实参<code>[[1,aa],[2,bb],[3,cc]]</code>，即用二维数组里面的每一个一维数组生成一条sql语句。 &#x000A;  那为何又会返回<code>int[]</code>呢？ &#x000A;  答：该方法的返回值是<code>int[]</code>，所以会返回诸如这样的结果：<code>[1,1,1]</code>，意思是生成的第一条sql语句影响数据库几行、生成的第二条sql语句影响数据库几行、生成的第三条sql语句影响数据库几行。</p>&#x000A;&#x000A;<h4>&#x000A;<a id="resultsethandler接口使用讲解" class="anchor" href="#resultsethandler%E6%8E%A5%E5%8F%A3%E4%BD%BF%E7%94%A8%E8%AE%B2%E8%A7%A3" aria-hidden="true"></a>ResultSetHandler接口使用讲解</h4>&#x000A;&#x000A;<p>该接口用于处理java.sql.ResultSet，将数据按要求转换为另一种形式。ResultSetHandler接口提供了一个单独的方法：<code>Object handle (java.sql.ResultSet .rs)</code>。</p>&#x000A;&#x000A;<p><strong>ResultSetHandler接口的实现类</strong></p>&#x000A;&#x000A;<ul>&#x000A;<li>ArrayHandler：把结果集中的<strong>第一行</strong>数据转成对象数组。</li>&#x000A;<li>ArrayListHandler：把结果集中的每一行数据都转成一个数组，再存放到List中。</li>&#x000A;<li>&#x000A;<strong>BeanHandler</strong>：将结果集中的<strong>第一行</strong>数据封装到一个对应的JavaBean实例中。</li>&#x000A;<li>&#x000A;<strong>BeanListHandler</strong>：将结果集中的每一行数据都封装到一个对应的JavaBean实例中，存放到List里。</li>&#x000A;<li>ColumnListHandler：将结果集中某一列的数据存放到List中。</li>&#x000A;<li>KeyedHandler(name)：将结果集中的每一行数据都封装到一个Map里，再把这些map再存到一个map里，其key为指定的key。</li>&#x000A;<li>MapHandler：将结果集中的第一行数据封装到一个Map里，key是列名，value就是对应的值。</li>&#x000A;<li>&#x000A;<strong>MapListHandler</strong>：将结果集中的每一行数据都封装到一个Map里，然后再存放到List。</li>&#x000A;</ul>&#x000A;&#x000A;<h4>&#x000A;<a id="dbutils类使用讲解" class="anchor" href="#dbutils%E7%B1%BB%E4%BD%BF%E7%94%A8%E8%AE%B2%E8%A7%A3" aria-hidden="true"></a>DbUtils类使用讲解</h4>&#x000A;&#x000A;<p>DbUtils：提供如关闭连接、装载JDBC驱动程序等常规工作的工具类，里面的所有方法都是静态的。主要方法如下：</p>&#x000A;&#x000A;<ul>&#x000A;<li>&#x000A;<code>public static void close(…) throws java.sql.SQLException</code> &#x000A;DbUtils类提供了三个重载的关闭方法。这些方法检查所提供的参数是不是NULL，如果不是的话，它们就关闭Connection、Statement和ResultSet。</li>&#x000A;<li>&#x000A;<code>public static void closeQuietly(…)</code> &#x000A;这一类方法不仅能在Connection、Statement和ResultSet为NULL情况下避免关闭，还能隐藏一些在程序中抛出的SQLException。</li>&#x000A;<li>&#x000A;<code>public static void commitAndCloseQuietly(Connection conn)</code> &#x000A;用来提交连接，然后关闭连接，并且在关闭连接时不抛出SQL异常。</li>&#x000A;<li>&#x000A;<code>public static boolean loadDriver(java.lang.String driverClassName)</code> &#x000A;这一方法装载并注册JDBC驱动程序，如果成功就返回true。使用该方法，你不需要捕捉这个异常ClassNotFoundException。</li>&#x000A;</ul>&#x000A;&#x000A;<h3>&#x000A;<a id="使用dbutils完成数据库的crud" class="anchor" href="#%E4%BD%BF%E7%94%A8dbutils%E5%AE%8C%E6%88%90%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84crud" aria-hidden="true"></a>使用DBUtils完成数据库的CRUD</h3>&#x000A;&#x000A;<p>在使用DBUtils完成数据库的CRUD之前，我们先编写测试用的SQL脚本：</p>&#x000A;<pre class="code highlight white sql"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`user`</span> <span class="p">(</span>&#x000A;  <span class="nv">`id`</span> <span class="n">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">auto_increment</span><span class="p">,</span>&#x000A;  <span class="nv">`name`</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>&#x000A;  <span class="nv">`age`</span> <span class="n">tinyint</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>&#x000A;  <span class="k">PRIMARY</span> <span class="k">KEY</span>  <span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>&#x000A;<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>&#x000A;</code></pre>&#x000A;&#x000A;<p><strong>使用dbutils遵从以下步骤</strong></p>&#x000A;&#x000A;<ol>&#x000A;<li>加载JDBC驱动程序类，并用DriverManager来得到一个数据库连接conn。</li>&#x000A;<li>实例化 QueryRunner,得到实例化对象qRunner。</li>&#x000A;<li>qRunner.update()方法，执行增改删的sql命令，qRunner.query()方法，得到结果集。</li>&#x000A;</ol>&#x000A;&#x000A;<h4>&#x000A;<a id="获取连接对象" class="anchor" href="#%E8%8E%B7%E5%8F%96%E8%BF%9E%E6%8E%A5%E5%AF%B9%E8%B1%A1" aria-hidden="true"></a>获取连接对象</h4>&#x000A;<pre class="code highlight white java"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:mysql://192.168.1.15:3306/test?useUnicode=true&amp;characterEncoding=utf8"</span><span class="o">;</span>&#x000A;<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">driver</span> <span class="o">=</span> <span class="s">"com.mysql.jdbc.Driver"</span><span class="o">;</span>&#x000A;<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">user</span> <span class="o">=</span> <span class="s">"znsd_test"</span><span class="o">;</span>&#x000A;<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"123456"</span><span class="o">;</span>&#x000A;&#x000A;<span class="kd">public</span> <span class="kd">static</span> <span class="n">Connection</span> <span class="nf">getConnect</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>&#x000A;    <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>&#x000A;    <span class="k">try</span> <span class="o">{</span>&#x000A;        <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">driver</span><span class="o">);</span>&#x000A;        <span class="n">conn</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>&#x000A;    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;    <span class="o">}</span>&#x000A;    <span class="k">return</span> <span class="n">conn</span><span class="o">;</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<h4>&#x000A;<a id="创建bean对象关联数据库" class="anchor" href="#%E5%88%9B%E5%BB%BAbean%E5%AF%B9%E8%B1%A1%E5%85%B3%E8%81%94%E6%95%B0%E6%8D%AE%E5%BA%93" aria-hidden="true"></a>创建bean对象关联数据库</h4>&#x000A;<pre class="code highlight white java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>&#x000A;    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span> <span class="c1">// 用户ID</span>&#x000A;    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span> <span class="c1">// 用户姓名</span>&#x000A;    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>  <span class="c1">// 用户年龄</span>&#x000A;    <span class="c1">// ...忽略set、get方法</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<h4>&#x000A;<a id="添加" class="anchor" href="#%E6%B7%BB%E5%8A%A0" aria-hidden="true"></a>添加</h4>&#x000A;<pre class="code highlight white java"><code><span class="kd">public</span> <span class="n">Integer</span> <span class="nf">add</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>&#x000A;        <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">();</span>&#x000A;        <span class="n">Connection</span> <span class="n">connect</span> <span class="o">=</span> <span class="n">ConnectionUtil</span><span class="o">.</span><span class="na">getConnect</span><span class="o">();</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">connect</span><span class="o">,</span> <span class="s">"insert into user(name, age) values(?, ?)"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">user</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>&#x000A;            <span class="n">DbUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">connect</span><span class="o">);</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<h4>&#x000A;<a id="修改" class="anchor" href="#%E4%BF%AE%E6%94%B9" aria-hidden="true"></a>修改</h4>&#x000A;<pre class="code highlight white java"><code><span class="kd">public</span> <span class="n">Integer</span> <span class="nf">update</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>&#x000A;&#x000A;        <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">();</span>&#x000A;        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionUtil</span><span class="o">.</span><span class="na">getConnect</span><span class="o">();</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">conn</span> <span class="o">,</span> <span class="s">"update user set name = ?, age = ? where id = ?"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">user</span><span class="o">.</span><span class="na">getAge</span><span class="o">(),</span> <span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>&#x000A;            <span class="n">DbUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">conn</span><span class="o">);</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<h4>&#x000A;<a id="删除" class="anchor" href="#%E5%88%A0%E9%99%A4" aria-hidden="true"></a>删除</h4>&#x000A;<pre class="code highlight white java"><code><span class="kd">public</span> <span class="n">Integer</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>&#x000A;&#x000A;        <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">();</span>&#x000A;        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionUtil</span><span class="o">.</span><span class="na">getConnect</span><span class="o">();</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">conn</span> <span class="o">,</span> <span class="s">"delete from user where id = ?"</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>&#x000A;            <span class="n">DbUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">conn</span><span class="o">);</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<h4>&#x000A;<a id="批量添加" class="anchor" href="#%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0" aria-hidden="true"></a>批量添加</h4>&#x000A;<pre class="code highlight white java"><code><span class="kd">public</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">batch</span><span class="p">(</span><span class="n">Object</span><span class="o">[][]</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>&#x000A;&#x000A;        <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">();</span>&#x000A;        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionUtil</span><span class="o">.</span><span class="na">getConnect</span><span class="o">();</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">batch</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="s">"insert into user(name, age) values(?, ?)"</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>&#x000A;            <span class="n">DbUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">conn</span><span class="o">);</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<h4>&#x000A;<a id="查询所有" class="anchor" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89" aria-hidden="true"></a>查询所有</h4>&#x000A;<pre class="code highlight white java"><code><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">select</span><span class="o">()</span> <span class="o">{</span>&#x000A;&#x000A;        <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">();</span>&#x000A;        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionUtil</span><span class="o">.</span><span class="na">getConnect</span><span class="o">();</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="s">"select id id1, name, age from user"</span><span class="o">,</span> <span class="k">new</span> <span class="n">UserBeanListHandler</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>&#x000A;            <span class="n">DbUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">conn</span><span class="o">);</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<h4>&#x000A;<a id="查询返回map" class="anchor" href="#%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9Emap" aria-hidden="true"></a>查询返回map</h4>&#x000A;<pre class="code highlight white java"><code><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">selectAsMap</span><span class="o">()</span> <span class="o">{</span>&#x000A;&#x000A;        <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">();</span>&#x000A;        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionUtil</span><span class="o">.</span><span class="na">getConnect</span><span class="o">();</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">userMaps</span> <span class="o">=</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="s">"select id id1, name, age from user"</span><span class="o">,</span> <span class="k">new</span> <span class="n">MapListHandler</span><span class="o">());</span>&#x000A;            <span class="k">return</span> <span class="n">userMaps</span><span class="o">;</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>&#x000A;            <span class="n">DbUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">conn</span><span class="o">);</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<h4>&#x000A;<a id="查询单个对象" class="anchor" href="#%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E5%AF%B9%E8%B1%A1" aria-hidden="true"></a>查询单个对象</h4>&#x000A;<pre class="code highlight white java"><code><span class="kd">public</span> <span class="n">User</span> <span class="nf">selectOne</span><span class="p">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>&#x000A;&#x000A;        <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">();</span>&#x000A;        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionUtil</span><span class="o">.</span><span class="na">getConnect</span><span class="o">();</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="s">"select id id1, name, age from user where id = ? limit 1"</span><span class="o">,</span> <span class="k">new</span> <span class="n">BeanHandler</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>&#x000A;                <span class="nd">@Override</span>&#x000A;                <span class="kd">public</span> <span class="n">User</span> <span class="n">handle</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>&#x000A;                    <span class="k">if</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>&#x000A;                        <span class="k">return</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">"id1"</span><span class="o">),</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">),</span> <span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">"age"</span><span class="o">));</span>&#x000A;                    <span class="o">}</span>&#x000A;                    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#x000A;                <span class="o">}</span>&#x000A;            <span class="o">},</span> <span class="n">id</span><span class="o">);</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>&#x000A;            <span class="n">DbUtils</span><span class="o">.</span><span class="na">closeQuietly</span><span class="o">(</span><span class="n">conn</span><span class="o">);</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#x000A;<span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<h2>&#x000A;<a id="结合c3p0数据源使用dbutils" class="anchor" href="#%E7%BB%93%E5%90%88c3p0%E6%95%B0%E6%8D%AE%E6%BA%90%E4%BD%BF%E7%94%A8dbutils" aria-hidden="true"></a>结合c3p0数据源使用dbutils</h2>&#x000A;&#x000A;<h3>&#x000A;<a id="c3p0简介" class="anchor" href="#c3p0%E7%AE%80%E4%BB%8B" aria-hidden="true"></a>c3p0简介</h3>&#x000A;&#x000A;<p>C3P0是一个开源的JDBC连接池，它实现了数据源和JNDI绑定，支持JDBC3规范和JDBC2的标准扩展。目前使用它的开源项目有Hibernate，Spring等</p>&#x000A;&#x000A;<h3>&#x000A;<a id="数据库连接池简介" class="anchor" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%AE%80%E4%BB%8B" aria-hidden="true"></a>数据库连接池简介</h3>&#x000A;&#x000A;<p>数据库连接池负责分配、管理和释放数据库连接，它允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个；连接池允许多个客户端使用缓存起来的连接对象，这些对象可以连接数据库，它们是共享的、可被重复使用的。</p>&#x000A;&#x000A;<p>打开/关闭数据库连接开销很大，连接池技术允许我们在连接池里维护连接对象，这样可以提高数据库的执行命令的性能。多个客户端请求可以重复使用相同的连接对象，当每次收到一个客户端请求时，就会搜索连接池，看看有没有闲置的连接对象。如果没有闲置对象的话，要么所有的客户端请求都进入队列排队，要么在池中创建一个新的连接对象（这取决于池里已经有多少个连接存在以及配置支持多少连接）。一旦某个请求使用完连接对象之后，这个对象会被重新放入池中，然后会被重新分派给排队等待的请求（分派给哪个请求要看使用什么调度算法）。因为大部分请求都是使用现存的连接对象，所以连接池技术大大减少了等待创建数据库连接的时间，从而减少了平均连接时间。</p>&#x000A;&#x000A;<p><img src="http://192.168.1.15/znsd/courses/uploads/2ff3dbc08d262ed449dfa8014547ff78/20171021162546066.png" alt="20171021162546066"></p>&#x000A;&#x000A;<h3>&#x000A;<a id="使用连接池的优点" class="anchor" href="#%E4%BD%BF%E7%94%A8%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%9A%84%E4%BC%98%E7%82%B9" aria-hidden="true"></a>使用连接池的优点</h3>&#x000A;&#x000A;<ul>&#x000A;<li><strong>资源重用：</strong></li>&#x000A;</ul>&#x000A;&#x000A;<p>由于数据库连接得以重用，避免了频繁创建，释放连接引起的大量性能开销。在减少系统消耗的基础上，另一方面也增加了系统运行环境的平稳性。</p>&#x000A;&#x000A;<ul>&#x000A;<li><strong>更快的系统反应速度：</strong></li>&#x000A;</ul>&#x000A;&#x000A;<p>数据库连接池在初始化过程中，往往已经创建了若干数据库连接置于连接池中备用。此时连接的初始化工作均已完成。对于业务请求处理而言，直接利用现有可用连接，避免了数据库连接初始化和释放过程的时间开销，从而减少了系统的响应时间。</p>&#x000A;&#x000A;<ul>&#x000A;<li><strong>统一的连接管理，避免数据库连接泄露：</strong></li>&#x000A;</ul>&#x000A;&#x000A;<p>在较为完善的数据库连接池实现中，可根据预先的占用超时设定，强制回收被占用连接，从而避免了常规数据库连接操作中可能出现的资源泄露。</p>&#x000A;&#x000A;<h3>&#x000A;<a id="使用步骤" class="anchor" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4" aria-hidden="true"></a>使用步骤</h3>&#x000A;&#x000A;<ol>&#x000A;<li>首先要导入c3p0和dbutils以及mysql的jar包</li>&#x000A;</ol>&#x000A;&#x000A;<ul>&#x000A;<li>c3p0-0.9.5.2.jar</li>&#x000A;<li>commons-dbutils-1.7.jar</li>&#x000A;<li>mchange-commons-java-0.2.11.jar</li>&#x000A;<li>mysql-connector-java-5.1.22.jar</li>&#x000A;</ul>&#x000A;&#x000A;<ol>&#x000A;<li>编写c3p0的配置文件<strong>c3p0-config.xml</strong>&#x000A;</li>&#x000A;</ol>&#x000A;&#x000A;<p>在src目录下存放c3p0的配置文件，配置文件是c3p0自己去识别并读入的，我们不需要在代码中做任何的操作，但是配置文件一定要命名为<strong>c3p0-config.xml</strong></p>&#x000A;<pre class="code highlight white xml"><code>   <span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>&#x000A;   <span class="nt">&lt;c3p0-config&gt;</span>&#x000A;    <span class="c">&lt;!-- 这是默认配置信息 --&gt;</span>&#x000A;    <span class="nt">&lt;default-config&gt;</span>&#x000A;        <span class="c">&lt;!-- jdbc连接四大参数配置 --&gt;</span>&#x000A;        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClass"</span><span class="nt">&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/property&gt;</span>&#x000A;        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jdbcUrl"</span><span class="nt">&gt;</span>jdbc:mysql://192.168.1.15:3306/test<span class="nt">&lt;/property&gt;</span>&#x000A;        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"user"</span><span class="nt">&gt;</span>znsd_test<span class="nt">&lt;/property&gt;</span>&#x000A;        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span><span class="nt">&gt;</span>123456<span class="nt">&lt;/property&gt;</span>&#x000A;&#x000A;        <span class="c">&lt;!-- 池参数配置 --&gt;</span>&#x000A;        <span class="c">&lt;!--JDBC的标准参数，用以控制数据源内加载的PreparedStatements数量。但由于预缓存的statements&#x000A;            属于单个connection而不是整个连接池。所以设置这个参数需要考虑到多方面的因素。&#x000A;            如果maxStatements与maxStatementsPerConnection均为0，则缓存被关闭。Default: 0&#x000A;        --&gt;</span>&#x000A;        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"acquireIncrement"</span><span class="nt">&gt;</span>3<span class="nt">&lt;/property&gt;</span>&#x000A;        <span class="c">&lt;!--初始化时获取的连接数，取值应在minPoolSize与maxPoolSize之间。Default: 3 --&gt;</span>&#x000A;        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"initialPoolSize"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/property&gt;</span>&#x000A;        <span class="c">&lt;!--连接池中保留的最小连接数。--&gt;</span>&#x000A;        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"minPoolSize"</span><span class="nt">&gt;</span>2<span class="nt">&lt;/property&gt;</span>&#x000A;        <span class="c">&lt;!--连接池中保留的最大连接数。Default: 15 --&gt;</span>&#x000A;        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"maxPoolSize"</span><span class="nt">&gt;</span>10<span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/default-config&gt;</span>&#x000A;   <span class="nt">&lt;/c3p0-config&gt;</span>&#x000A;</code></pre>&#x000A;&#x000A;<ol>&#x000A;<li>使用c3p0获取获取数据库连接对象</li>&#x000A;</ol>&#x000A;<pre class="code highlight white java"><code>   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">C3p0ConnectionUtil</span> <span class="o">{</span>&#x000A;&#x000A;    <span class="c1">// 配置文件的默认配置！要求你必须给出c3p0-config.xml</span>&#x000A;    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ComboPooledDataSource</span> <span class="n">c3p0DataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComboPooledDataSource</span><span class="o">();</span>&#x000A;&#x000A;    <span class="cm">/**&#x000A;     * 获取连接对象&#x000A;     * @return&#x000A;     */</span>&#x000A;    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Connection</span> <span class="n">getConnection</span><span class="o">()</span> <span class="o">{</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="c1">// 得到连接器</span>&#x000A;            <span class="k">return</span> <span class="n">c3p0DataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>&#x000A;    <span class="o">}</span>&#x000A;&#x000A;    <span class="cm">/**&#x000A;     * 获取数据源&#x000A;     * &#x000A;     * @return&#x000A;     */</span>&#x000A;    <span class="kd">public</span> <span class="kd">static</span> <span class="n">DataSource</span> <span class="n">getDataSource</span><span class="o">()</span> <span class="o">{</span>&#x000A;        <span class="k">return</span> <span class="n">c3p0DataSource</span><span class="o">;</span>&#x000A;    <span class="o">}</span>&#x000A;   <span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<ol>&#x000A;<li>dbutils 使用c3p0</li>&#x000A;</ol>&#x000A;<pre class="code highlight white java"><code>   <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">add</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>&#x000A;        <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">(</span><span class="n">C3p0ConnectionUtil</span><span class="o">.</span><span class="na">getDataSource</span><span class="o">());</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"insert into user(name, age) values(?, ?)"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">user</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>&#x000A;   <span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<ol>&#x000A;<li>返回主键例子</li>&#x000A;</ol>&#x000A;<pre class="code highlight white java"><code>   <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">add</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>&#x000A;        <span class="n">DataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="n">C3p0ConnectionUtil</span><span class="o">.</span><span class="na">getDataSource</span><span class="o">();</span>&#x000A;        <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>&#x000A;        <span class="k">try</span> <span class="o">{</span>&#x000A;            <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"insert into user(name, age) values(?, ?)"</span><span class="o">;</span>&#x000A;                <span class="c1">// 需要条用insert方法，指定MapHandler参数</span>&#x000A;            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">idMap</span> <span class="o">=</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">sql</span><span class="o">,</span> <span class="k">new</span> <span class="n">MapHandler</span><span class="o">()</span> <span class="o">{</span>&#x000A;&#x000A;                <span class="nd">@Override</span>&#x000A;                <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">handle</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>&#x000A;&#x000A;                    <span class="c1">//rs = rs.getStatement().getGeneratedKeys();</span>&#x000A;                        <span class="c1">// 获取主键</span>&#x000A;                    <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">?</span> <span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>&#x000A;                    <span class="c1">// 将数据库返回主键放入map中</span>&#x000A;                    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">idMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>&#x000A;                    <span class="n">idMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>&#x000A;&#x000A;                    <span class="k">return</span> <span class="n">idMap</span><span class="o">;</span>&#x000A;                <span class="o">}</span>&#x000A;            <span class="o">},</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">user</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>&#x000A;&#x000A;            <span class="k">return</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span> <span class="n">idMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>&#x000A;        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>&#x000A;            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>&#x000A;        <span class="o">}</span>&#x000A;        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>&#x000A;   <span class="o">}</span>&#x000A;</code></pre>&#x000A;&#x000A;<p>​</p>
</div>
</article>

</div>
<div class='tree_progress'></div>
<script>
  // Load last commit log for each file in tree
  $('#tree-slider').waitForImages(function() {
    ajaxGet('/znsd/courses/refs/master/logs_tree/DBUtils');
  });
</script>

</div>

</div>
</div>
</div>
</div>
</div>

<script>
  GitLab.GfmAutoComplete.dataSource = "/znsd/courses/autocomplete_sources?type=NilClass&type_id=master%2FDBUtils"
  GitLab.GfmAutoComplete.setup();
</script>


</body>
</html>


